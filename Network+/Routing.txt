Routing

Intoduction to Routers
    All computers on broadcast domain have to have similar network id. To connect to another network, go through router. Siwtches 
filter and forward based on MAC address, While routers filter and forward based on IP address. Most routers have network switches
and Wireless access points etc. In order for a router to functions it needs two connections between network ids. A router say with
two ethernet connections, between two networks with two different network ids. Each ntwork will have its own id, like a default 
gateway. An ip packet will have a source and destination's network id, which is checked in a routers Routing table. A routing table 
has four columns, an Address column, which stores network ids ending with 0, a Subnet mask, a Gateway like 0.0.0.0 which means it's
directly connected, and an Interface, which is network id's ending in 1. To connect to the "outside world", routers will use what is
called a Default Route. Connect local network to Upstream Router provided by ISP. Upstream router is a Default Gateway. The upstream
router is stored in the Routing table as Address: 0.0.0.0, subnet mask of 0.0.0.0, With a valid Gateway address and an Interface address.
When a router see's gateway as all 0's, it can ARP that system and asks for an ARP address. The only thing routers do is read the destination
ip address and change MAC address to which pc needs to recieve info. Most routers will only have two connections, one for network and
another for the internet. Routers can have more connections in a case like having two different ISPs. In the case of two isps, router
will have one connection for local network and a connection each for ISPs. The routing table will have a default route for each isp. 
The routing table will then add a metric column. The lower the metric number, the higher the priority when choosing between ISPs. 
    Routers don't care where a packet comes froms, only where its going. Routers are not tied to ethernet. Routers can have DSL, 
optical etc. Routers only care about the ip packet

Review:
    *Routers only care about the destinations
    *Routers can use any network medium
    *All routers have routing table

******************************************************************************************************************************************

Ports
    Ports determine which user level application info from ip packet is sent from. Server will send data to http on port 80, which
is destination port number, and source port number to send info back to. FTP is port 21, Email would be something like port 10. Source
port number is generated by pc. Has to be number past 1024. Web server must have dest port, and client must have source port. Soure port
is ephemeral. Server recieves packet, reverse dest and src data, and send packet back. Data is kept organized with sequencing number

Review:
    *Every TCP packet has two port numbers
    *Well known port numbers run from 0 to 1023
    *Clients generate ephermeral numbers that are always between 1024 and 65535

*****************************************************************************************************************************************

Network Address Translation NAT
    Built into routers. Switches privates ip addresses with the router's address but saves the sender's local ip. When info returns
router looks at Routing Table for local ip address of the reciever. This allows for fewer public ip addresses on the net. 
    Different versions of NAT: Static NAT(SNAT) = Port Forwarding. All data on one ip address goes to single machine. Dynamic NAT
or Pooled NAT. Store public IP address for machines to use for port forwarding.

Review:
    *PAT translates internal IP addresses to an internet address and tracks the packets. 
    *SNAT sends specific traffic to one internal ip address
    *DNAT has a limited pool of internet addresses to give to a number of internal devices.

****************************************************************************************************************************************

Implementing NAT
    Home router scenario. Most have NAT turned on by default. Enterprise routers have NAT turned off by default. *WAN == Wide-area
network, and LAN = Local Area network. WAN is public ip. 

Review:
    *SOHO (small office and home office) routers ship with NATenables
    *NAT on a SOHO router can be disabled from the routers configuartion page
    *Some older routers call this setting gateway/router mode

NAT Youtube
    A way to conserve ip addresses. NAT converts public addresses to private addresses. 4 billion public ip addresses available.
When local machine needs to access internet, their private ip address will be translated into the one public ip. NAT was needed to 
solve the IPV4 problem. When everything moves to IPv6, NAT will no longer be needed

****************************************************************************************************************************************

Forwarding Ports

    SOHO firewalls will block unitiated information when not configured to do so, called forwarding ports. This allows for things like
servers within a local network to speak to the internet. 
    Port Forwarding on a NAT cpable router to remotely access a local machine with a WAN ip address of 1.1.1.1(bogus ip). Machine has 
address of 192.168.5.11. For demonstration, network has a security camera with ip of 192.168.5.13 talking to local machines. TO access
camera from outside world, port forwarding is needed. Cofigure port fowrarding on NAT router 1.1.1.1 on port 8181. Connect port of 
camera(port 80) with link to WAN ip address port of 8181. Access camera on WAN with ip addr:8181. TO configure, log into router with 
defalt gateway ip wbpage. Find port forwarding options and cofigure port from(8181) and port to (80. Camera). Use 'offbeat' ports for 
security. Port forwarded devices should be password protected. 
    Port Range Forwarding opens multiple ports. Some devices will use cloud to access machine locally instead of ports, but aren't as
secure. 
    Port Triggering is a type of forwarding, say with FTP(port 20 and 21), where client will send on port 21 but recieve on 20, which 
causes a problem. Port triggering allows both 20 and 21 open when data is sent on 21, to allowfor reception of data. TO configure, log 
into router and find Port Triggering. Configure trigger range of FTP client and server. 
    SOHO DMZ is a forwarding of ports allows anything on the internet to be sent to a specific machine. DMZs are set up as a trap
for hackers. To cofigure in router, find DMZ tab and configure Ip of dmz. On test, questions about which ports for which applications
are used and how to configure them.

Review:
    *Port forwarding allows external devices to have internal communication through a router
    *Port triggering will open an alternative assigned port when the inital port is contacted
    *Enabling DMZ when setting up port forwading places that device outside protection of that router
****************************************************************************************************************************************

Tour of SOHO Router
    All routers will have some type of documentation. All routers will have a default ip, username and password. Most will come with
propietary software which usually isn't used. TO access, plug machine into LAN port and look for default gateway. The default ip of
router can be reconfigured. WAN connection type can have AUto DHCP. Routers can be hacked if default gateway is left as default. MAC
address clone are good for cable modums by getting MAC address from pc and typing it in. Telenet and SSH can be configure here to be 
reached by the internet. In Web access tab, you can configure wether they use HTTP or HTTPS. Remote access allows for router access
remotely, which can be dangerous. Firewalls can be configured to pick up on traffic that wasn't initiated by machine on network. You 
can block certain apps or block traffic during certain times. Firmware can be upgraded here by downloading update from manufacturer.
This can trash a router. To fix busted router, unplug all cables and hit the hard reset button for 30 seconds, with button held 
unplug cable for 30 seconds, then plug back in, with button still held, for another 30 seconds. 

Review:
    *All home routers have a default ip address, username and password
    *Almost all home routers are DHCP servers
    *Router WAN connections are commonly DHCP clients by default.
**************************************************************************************************************************************

SOHO vs Enterprise Router
    SOHOs are gateway routers, which is one default gateway connected to internet. These will have a switch built in and a built in
Wireless Access Point built in. DHCP is also built in. An Enterprise level router is more robust. Has multiple internet connections 
on back. Has good power supplies. Enterprise won't have wireless connection or switches. 100x the bandwith and can handles 10's of multiple 
connections compared to SOHO. SOHO has an easier customizable firewall. SOHO will have web interface while Enterprise routers won't. Conncet 
to enterprise router via Putty. Cisco routers have its own command line OS. Has it's own language, and things like IP address and VPNs can be
set up. 

Review:
    *SOHO routers are for small groups (5-6 devices) and can have built-in capability for switches, firewalls and WAPs (Wireless access points)
    *Enterprice routers have expanded connection capability to other devices (i.e. routers, switches and WAP's)
    *SOHO routers often have Web-based interfaces, enterprise routers typically have their own OS interface

**************************************************************************************************************************************

Static Routes
    All routers, along with all computers have Routing Tables. To look at routing table on windows, type ">route print". 
Active Routes:
Network destination     Netmask     Gateway     Interface       Metric
0.0.0.0                 0.0.0.0     192.168.4.1 192.168.4.76        76: I don't care where the info is going, send through gateway,
                                                                        on network card(Interface) with priority 76, Unless...
127.0.0.0               255.0.0.0    on-line    127.0.0.1          331: going to local host. on-line means don't go to gateway.
127.0.0.1               255.255.255.255 ol      127.0.0.1          331: same thing as above.
192.168.4.0             /24          on-line    $(my ip)        281: send out though net, not gateway. forwarded port
$(My ip)                /32          on-line    $(my ip)              : sends to self

*Multicast (class D) ip starts with 224 and is a secondary, temporary ip address
*netstat -r 

Scenario:
    Two switches hooked together locally. Link static routes between switches. 

Static routes are good for little internal networks, but get too complicated when talking on the internet

Review:
    *A static route is a fixed route that is manually configured and persistent
    *Use route print or netstat -r to display current known routes from the routing tables
    *Routing tables contain address information for destination, subnet mask, gateway and NIC
*************8************************************************************************************************************************

Dynamic Routing
    Combats convergence issues when connections or routers go down. The purpose of routes is to not only facility connections, but
use certain methods to keep things running smoothly or dynamically. Dynamic routing is just the logic for this within a router. 
Convergence = All routes hard connected. The Metric value is essentially the priority for routes. Hop Count is the number a routers
to get to the network id. MTU Maxiumum Transmission Unit is the measure of data hauled within a frame. Bandwith is the spead of transmission
of data through a network. Latency is the measure of the reaction time of a route. 
    Two sub sections of Dynamic Routing: Distance Vector and Link State. DV is older, sometimes refered to as RIP. Sends entire rotuing
table to neighboring routers. Big issues with hop count. Also sends in intervals, which can be slow. Link State is modern and improved,
which sends out Link State Advertisments, which is sort of like a ping, and when an anomaly is detected, notifies other routers. Link
state doesn't send out the whole routing table 
    All Dynamic routing can be broken into two groups: Interior gateway protocols and exterier gateway protocols. All routers within
an AS or Autonomous System is one organization or routers under one systems control. To communicate outside of AS, use an EGP, otherwise
using IGP for external work. Only EGP in BGP, or Border Gateway Protocol, which asigns you an Autonomous system number (ASN). 

Review:
    *Dynamic Routing protocols use metrics to determine routes and are either distance vector or link state
    *Dynamic routing protocols are either IGP(Interior Gateway Protocol) or EGP(Exterior Gateway Protocol)
    *BGP is the EGP protocol used for Inter-Autonomous system routing. 
*************8************************************************************************************************************************

RIP Routing Information Protocol
    Used is smaller networks, Interior Gateway Protocol and Distance Vector Protocol. Routers have to be configured for RIP. A group
of routers will show each other their routing tables. Learns of multiple "ways" to a certain network, derives the metric from hop count
and decides the faster path. Downside to RIP is how long it takes to reach convergence. RIP v1 could only do Classful netrworks, not
CIDRs. RIP v2 can handle CIDR newtorks and has more security. RIP max hop count is 15. 

Review:
    *RIp is a distance vector protocol that uses hop count to determine routes
    *RIP1 used only classful networks
    *RIP max hop count is 15
*************8************************************************************************************************************************

OSPF Open Shortest Path First
    Number one Dynamic ROuting Protocol. Pain to configure. IGP(Interior Gateway Protocol), link state. When OSPF routers are linked, 
they start sending Link State Advertisments. The 'Boss' is the designated router, each router is configured to be in designated Area ID.
These look like ip addresses. Once they know area id, they elect a designated router and talk to each other. The link advertisments tell
each router which network they're connected to. Send out link states insstead of routing tables. Great for CDIR. Work  

Review:
    *OSPF is a link state protocol
    *OSPF uses Area IDs
    *OSPF converges very quickly

*************8************************************************************************************************************************

BGP Border Gateway Protocol
    BGP is a hybrid protocol, which means it has aspects of Distancnce vector and Link State Protocol. Cornerstone of how ISPs connect
with internet. Internet is two types of internet, LAN and WAN. LAN are sections of local subnets. Router Networks are the collection 
of routers owned by ISPs, carrying data from LANS to WANs. LANs are connected by router newtorks. Routing protocols like OSPF can't
handle 10,000+ connection in routing tables. BGP breaks entire internet into 20000 Autonomous Systems, which is a group of one or more
router newtorks own by a single entity. Every system has a 32 bit AS number. Every AS has total control on network routes via something 
like OSPF, but when these Autonomous systems want to connect, they use BGP. If an AS wants to send info to the broader internet, it sends
data to it's BGP router on the 'edge'. Works like a default gateway on a router. 

Review:
    *BGP is a hybrid protocol
    *BGP is the primary protocol for the internet
    *BGP is based around the concept of the autonomous system

